<!DOCTYPE html>
<html>
<head>
    <title>Soko Safi WebSocket Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Soko Safi Real-Time Test</h1>
    
    <div>
        <h3>Connection</h3>
        <input type="number" id="userId" placeholder="Your User ID" value="1">
        <button onclick="joinChat()">Join Chat</button>
        <div id="status"></div>
    </div>

    <div>
        <h3>Send Message</h3>
        <input type="number" id="receiverId" placeholder="Receiver ID" value="2">
        <input type="text" id="messageText" placeholder="Message">
        <button onclick="sendMessage()">Send</button>
    </div>

    <div>
        <h3>Chat History</h3>
        <input type="number" id="chatUser1" placeholder="User 1 ID" value="1">
        <input type="number" id="chatUser2" placeholder="User 2 ID" value="2">
        <button onclick="getChatHistory()">Get History</button>
    </div>

    <div>
        <h3>Messages</h3>
        <div id="messages" style="border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px;"></div>
    </div>

    <script>
        const socket = io('http://localhost:5000');
        
        socket.on('connect', () => {
            document.getElementById('status').innerHTML = 'Connected to server';
        });

        socket.on('status', (data) => {
            addMessage('System: ' + data.msg);
        });

        socket.on('new_message', (data) => {
            addMessage(`Message from ${data.sender_id}: ${data.message} (${data.timestamp})`);
        });

        socket.on('message_sent', (data) => {
            addMessage(`Message sent successfully (ID: ${data.message_id})`);
        });

        socket.on('notification', (data) => {
            addMessage(`ðŸ”” Notification [${data.type}]: ${data.data.message}`);
        });

        socket.on('chat_history', (data) => {
            addMessage('--- Chat History ---');
            data.messages.forEach(msg => {
                addMessage(`${msg.sender_id} â†’ ${msg.receiver_id}: ${msg.message} (${msg.timestamp})`);
            });
            addMessage('--- End History ---');
        });

        function joinChat() {
            const userId = document.getElementById('userId').value;
            socket.emit('join', {user_id: parseInt(userId)});
        }

        function sendMessage() {
            const senderId = document.getElementById('userId').value;
            const receiverId = document.getElementById('receiverId').value;
            const message = document.getElementById('messageText').value;
            
            socket.emit('send_message', {
                sender_id: parseInt(senderId),
                receiver_id: parseInt(receiverId),
                message: message
            });
            
            document.getElementById('messageText').value = '';
        }

        function getChatHistory() {
            const user1 = document.getElementById('chatUser1').value;
            const user2 = document.getElementById('chatUser2').value;
            
            socket.emit('get_chat_history', {
                user1: parseInt(user1),
                user2: parseInt(user2)
            });
        }

        function addMessage(message) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML += '<div>' + message + '</div>';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>